<div class="home-hero section-container" id="background_selection">
    <form hx-encoding='multipart/form-data' hx-post='/createEvent/background/' style="display: flex; flex-wrap: wrap; justify-content: center;">
        <div class="home-container05" style="padding: 10px">
            {% csrf_token %}

            <input
                type="text" 
                id="search_query" 
                name="search_query" 
                placeholder="Search for images"
                class="home-textinput white_input"
            />
            {% if event_id %}
            <input type="hidden" name="event_id" value="{{ event_id }}">
            {% endif %}
            <button type="submit" class="home-button button">Select</button>
            
        </div>
        <div id="image-container" style="display: flex; flex-wrap: wrap; justify-content: flex-start; width: 70vw">
            {% for image in backgrounds %}
                <label style="width: 20vw; height: 15vw; margin: 10px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                    <input type="radio" name="selected_image" value="{{ image.pk }}" style="display: none;">
                    <img src="{{ image.pattern_bg }}" alt="{{ image.title_bg }}" style="width: 100%; height: 100%; object-fit: cover;">
                </label>
            {% endfor %}
        </div>
    </form>
</div>

<script>
    var images = document.querySelectorAll('#image-container img');
    // only show the first 6 images
    images.forEach(function(image, index) {
        if (index < 6) {
            image.parentNode.style.display = 'block';
            image.style.border = '2px solid white';
            image.style.borderRadius = '5px';
        } else {
            image.parentNode.style.display = 'none';
            image.style.border = '2px solid white';
            image.style.borderRadius = '5px';
        }
    });


    document.getElementById('search_query').addEventListener('input', function() {
        var searchQuery = this.value.toLowerCase();
        var images = document.querySelectorAll('#image-container img');
        var matchCount = 0;
        
        images.forEach(function(image) {
            var altText = image.getAttribute('alt').toLowerCase();
            
            if (altText.includes(searchQuery)) {
                if (matchCount < 6) {
                    image.parentNode.style.display = 'block';
                    matchCount++;
                } else {
                    image.parentNode.style.display = 'none';
                }
            } else {
                image.parentNode.style.display = 'none';
            }
        });
    });

    // when a radio button is selected, add a border to the image
    document.querySelectorAll('#image-container input').forEach(function(input) {
        input.addEventListener('change', function() {
            var images = document.querySelectorAll('#image-container img');
            
            images.forEach(function(image) {
                if (image.parentNode.querySelector('input').checked) {
                    image.style.border = '2px solid blue';
                    image.style.borderRadius = '5px';
                } else {
                    image.style.border = '2px solid white';
                    image.style.borderRadius = '5px';
                }
            });
        });
    });
</script>
